<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ondřej Mottl">
<meta name="dcterms.date" content="2024-09-04">

<title>VegVault - VegVault - technical overview</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">VegVault</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../Technical_overview/Technical_overview_master.html" aria-current="page"> 
<span class="menu-text">Technical Overview</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../materials.html"> 
<span class="menu-text">Materials</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <a href="http://twitter.com/OndrejMottl" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/OndrejMottl/VegVault" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#section-i-description-of-vegvault" id="toc-section-i-description-of-vegvault" class="nav-link active" data-scroll-target="#section-i-description-of-vegvault">Section I: Description of VegVault</a>
  <ul class="collapse">
  <li><a href="#data-structure" id="toc-data-structure" class="nav-link" data-scroll-target="#data-structure">Data Structure</a></li>
  </ul></li>
  <li><a href="#section-ii-overview-of-vegvault-1.0.0" id="toc-section-ii-overview-of-vegvault-1.0.0" class="nav-link" data-scroll-target="#section-ii-overview-of-vegvault-1.0.0">Section II: Overview of VegVault 1.0.0</a>
  <ul class="collapse">
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a>
  <ul class="collapse">
  <li><a href="#dataset-type" id="toc-dataset-type" class="nav-link" data-scroll-target="#dataset-type">Dataset Type</a></li>
  <li><a href="#dataset-source-type" id="toc-dataset-source-type" class="nav-link" data-scroll-target="#dataset-source-type">Dataset Source-Type</a></li>
  <li><a href="#dataset-source" id="toc-dataset-source" class="nav-link" data-scroll-target="#dataset-source">Dataset Source</a></li>
  <li><a href="#sampling-method" id="toc-sampling-method" class="nav-link" data-scroll-target="#sampling-method">Sampling method</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  <li><a href="#samples" id="toc-samples" class="nav-link" data-scroll-target="#samples">Samples</a>
  <ul class="collapse">
  <li><a href="#dataset-sample" id="toc-dataset-sample" class="nav-link" data-scroll-target="#dataset-sample">Dataset-Sample</a></li>
  <li><a href="#sample-size" id="toc-sample-size" class="nav-link" data-scroll-target="#sample-size">Sample-size</a></li>
  <li><a href="#sample-age" id="toc-sample-age" class="nav-link" data-scroll-target="#sample-age">Sample age</a></li>
  <li><a href="#sample-reference" id="toc-sample-reference" class="nav-link" data-scroll-target="#sample-reference">Sample reference</a></li>
  </ul></li>
  <li><a href="#taxa" id="toc-taxa" class="nav-link" data-scroll-target="#taxa">Taxa</a>
  <ul class="collapse">
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification">Classification</a></li>
  </ul></li>
  <li><a href="#traits" id="toc-traits" class="nav-link" data-scroll-target="#traits">Traits</a>
  <ul class="collapse">
  <li><a href="#trait-domain" id="toc-trait-domain" class="nav-link" data-scroll-target="#trait-domain">Trait domain</a></li>
  <li><a href="#trait-values" id="toc-trait-values" class="nav-link" data-scroll-target="#trait-values">Trait Values</a></li>
  <li><a href="#trait-reference" id="toc-trait-reference" class="nav-link" data-scroll-target="#trait-reference">Trait reference</a></li>
  </ul></li>
  <li><a href="#abiotic-data" id="toc-abiotic-data" class="nav-link" data-scroll-target="#abiotic-data">Abiotic data</a></li>
  </ul></li>
  <li><a href="#section-iii-assembly-details-of-vegvault-1.0.0" id="toc-section-iii-assembly-details-of-vegvault-1.0.0" class="nav-link" data-scroll-target="#section-iii-assembly-details-of-vegvault-1.0.0">Section III: Assembly details of VegVault 1.0.0</a>
  <ul class="collapse">
  <li><a href="#assembly-process" id="toc-assembly-process" class="nav-link" data-scroll-target="#assembly-process">Assembly process</a>
  <ul class="collapse">
  <li><a href="#note-on-github-tags" id="toc-note-on-github-tags" class="nav-link" data-scroll-target="#note-on-github-tags">Note on GitHub Tags</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#section-iv-examples-of-usage" id="toc-section-iv-examples-of-usage" class="nav-link" data-scroll-target="#section-iv-examples-of-usage">Section IV: Examples of usage</a>
  <ul class="collapse">
  <li><a href="#example-1-spatiotemporal-patterns-of-the-picea-genus-across-north-america-since-the-lgm" id="toc-example-1-spatiotemporal-patterns-of-the-picea-genus-across-north-america-since-the-lgm" class="nav-link" data-scroll-target="#example-1-spatiotemporal-patterns-of-the-picea-genus-across-north-america-since-the-lgm">Example 1: Spatiotemporal patterns of the Picea genus across North America since the LGM</a></li>
  <li><a href="#example-2-joined-species-distribution-model-for-all-vegetation-within-czechia" id="toc-example-2-joined-species-distribution-model-for-all-vegetation-within-czechia" class="nav-link" data-scroll-target="#example-2-joined-species-distribution-model-for-all-vegetation-within-czechia">Example 2: Joined Species Distribution model for all vegetation within Czechia</a></li>
  <li><a href="#example-3-patterns-of-plant-height-cwm-for-south-and-central-latin-america-between-6-12-ka" id="toc-example-3-patterns-of-plant-height-cwm-for-south-and-central-latin-america-between-6-12-ka" class="nav-link" data-scroll-target="#example-3-patterns-of-plant-height-cwm-for-south-and-central-latin-america-between-6-12-ka">Example 3: Patterns of plant height (CWM) for South and Central Latin America between 6-12 ka</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">VegVault - technical overview</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ondřej Mottl </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 4, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="section-i-description-of-vegvault" class="level1">
<h1>Section I: Description of VegVault</h1>
<p><strong>VegVault</strong> is a SQLite interdisciplinary database linking plot-based vegetation data with functional traits and climate.</p>
<p>Vault integrates data from multiple well-established sources to provide a comprehensive view of vegetation dynamics. By organizing data into clearly defined types and providing comprehensive referencing, VegVault supports detailed and high-quality ecological research. This structured approach ensures that data are accessible, reliable, traceable, and facilitate a wide range of analyses and applications across disciplines. See the Data Acquisition section for more details about reproducibility.</p>
<section id="data-structure" class="level2">
<h2 class="anchored" data-anchor-id="data-structure">Data Structure</h2>
<p>VegVault is organized into several section to systematically manage the varying datasets it integrates. The main structure is the <code>Dataset</code>, which serves as the cornerstone of the database structure. <code>Datasets</code> are further linked to <code>Samples</code>, representing individual data points within each dataset. Each <code>Dataset</code> can be linked to several <code>Samples</code> only if the samples differ in their age. Moreover, Each <code>Dataset</code> is classified into one of four types:</p>
<ul>
<li>current vegetation plots,</li>
<li>past vegetation (fossil pollen records)</li>
<li>functional traits</li>
<li>gridpoint (a dataset type created to hold abiotic data, see details below).</li>
</ul>
<p>For current and past vegetation <code>Dataset</code>, the <code>Samples</code> holds information about their vegetation, and are linked to specific <code>Taxa</code>, which are the taxa names derived directly from the main data sources. <code>Trait</code> information is organised in separate <code>Datasets</code> (as they are associated with unique information about their spatio-temporal location, references, etc) but associated with these same <code>Taxa</code> codes as vegetation data. Moreover, each <code>Taxa</code> disregard of the source is associated with classification information (i.e.&nbsp;species, genus and family name). “<em>Gridpoints</em>” are artificially created <code>Datasets</code> with even spatio-temporal resolution to hold the abiotic information. While the vegetation data is the main focus of the database, the structure of using separete <code>Datasets</code> ensuree a comprehensive organization of the data (see Figure XXX). Note that this is just a simplified description of the database structure, see XXX for full database structure.</p>
</section>
</section>
<section id="section-ii-overview-of-vegvault-1.0.0" class="level1">
<h1>Section II: Overview of VegVault 1.0.0</h1>
<section id="dataset" class="level2">
<h2 class="anchored" data-anchor-id="dataset">Dataset</h2>
<p>The <code>Dataset</code> represents the main structure in the VegVault, serving as the keystone for organizing and managing data. Currently, the VegVault database holds over 480,000 Datasets (of which approximately 100,000 are gridpoints, which are artificially created to hold abiotic data, see details below). Here we will explain some, but not all, of the features of the <code>Dataset</code>.</p>
<p><img src="DB_scheme_visualisation/Datasets.png" style="width:100.0%" data-fig-align="center"></p>
<section id="dataset-type" class="level3">
<h3 class="anchored" data-anchor-id="dataset-type">Dataset Type</h3>
<p>The <code>Dataset Type</code> defines the most basic classification of each <code>Dataset</code>, ensuring that the vast amount of data is categorized systematically. Currently, <strong>VegVault</strong> contains the following types of Datasets:</p>
<ul>
<li><code>vegetation_plot</code>: This type includes current vegetation plot data, capturing contemporary vegetation characteristics and distributions.</li>
<li><code>fossil_pollen_archive</code>: This type encompasses past vegetation plot data derived from fossil pollen records, providing insights into historical vegetation patterns.</li>
<li><code>traits</code>: This <code>Dataset</code> contains functional trait data, detailing specific characteristics of plant species that influence their ecological roles.</li>
<li><code>gridpoints</code>: This type holds artificially created Datasets to manage abiotic data, such as climate and soil information</li>
</ul>
<p><img src="DB_scheme_visualisation/DatasetTypeID.png" style="width:100.0%" data-fig-align="center"></p>
<p><img src="../Figures/ fig_n_datasetes_per_type .png" style="width:100.0%" data-fig-align="center"></p>
</section>
<section id="dataset-source-type" class="level3">
<h3 class="anchored" data-anchor-id="dataset-source-type">Dataset Source-Type</h3>
<p>Each <code>Dataset</code> is derived from a specific <code>Source-Type</code> provides detailed information on the source, which was used to retrieve the original data, enhancing the findability and referencing of primary data sources. The current <code>Source-Types</code> in <strong>VegVault</strong> include</p>
<ul>
<li><strong>BIEN</strong> - <a href="https://bien.nceas.ucsb.edu/bien/">Botanical Information and Ecology Network</a></li>
<li><strong>sPlotOpen</strong> - <a href="https://idiv-biodiversity.de/en/splot/splotopen.html">The open-access version of sPlot</a></li>
<li><strong>TRY</strong> - <a href="https://www.try-db.org/TryWeb/Home.php">TRY Plant Trait Database</a></li>
<li><strong>FOSSILPOL</strong> - <a href="https://hope-uib-bio.github.io/FOSSILPOL-website/">The workflow that aims to process and standardise global palaeoecological pollen data</a>. Note that we specifically state FOSSILPOL and not Neotoma, as FOSSILPOL not only provides the data but also alters it (e.g, new age-depth models).</li>
<li><strong>gridpoints</strong> - artificially created <code>Datasets</code> to hold abiotic data</li>
</ul>
<p><img src="DB_scheme_visualisation/DatasetSourceTypeID.png" style="width:100.0%" data-fig-align="center"></p>
<p><img src="../Figures/ fig_n_datasetes_per_source_type .png" style="width:100.0%" data-fig-align="center"></p>
<p><img src="../Figures/ p_n_datasetes_per_type_per_source_type .png" style="width:100.0%" data-fig-align="center"></p>
</section>
<section id="dataset-source" class="level3">
<h3 class="anchored" data-anchor-id="dataset-source">Dataset Source</h3>
<p>Each individual <code>Dataset</code> from a specific <code>Dataset</code> <code>Source-Type</code> can have information on the source of the data (i.e.&nbsp;sub-database). This should help to promote better findability of the primary source of data and referencing.</p>
<p><img src="DB_scheme_visualisation/DatasetSourcesID.png" style="width:100.0%" data-fig-align="center"></p>
<p>Currently, there are 706 sources of datasets.</p>
<p><img src="../Figures/ fig_n_datasetes_per_source .png" style="width:100.0%" data-fig-align="center"></p>
</section>
<section id="sampling-method" class="level3">
<h3 class="anchored" data-anchor-id="sampling-method">Sampling method</h3>
<p>Sampling methods vary significantly across the different types of <code>Datasets</code> integrated into <strong>VegVault</strong>, reflecting the diverse nature of the data collected. For current vegetation plots, sampling involves standardized plot inventories and surveys that capture detailed vegetation characteristics across various regions. In contrast, fossil pollen data are collected from sediment cores, representing past vegetation and depositional environments. These sampling methods are crucial for understanding the context and limitations of each Dataset Type. Therefore, information on sampling methods is only present for both <code>vegetation_plot</code> and <code>fossil_pollen_archive</code> <code>Datasets</code>, providing metadata that ensures accurate and contextually relevant analyses</p>
<p><img src="DB_scheme_visualisation/SamplingMethodID.png" style="width:100.0%" data-fig-align="center"></p>
<p><img src="../Figures/ fig_n_sampling_methods_per_dataset_type .png" style="width:100.0%" data-fig-align="center"></p>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<p>To support robust and transparent scientific research, each <code>Dataset</code> in <strong>VegVault</strong> can have multiple references at different levels. The <code>Dataset</code> <code>Source-Type</code>, <code>Dataset Source</code>, and <code>Sampling Method</code> can all have their own references, providing detailed provenance and citation information. This multi-level referencing system enhances the traceability and validation of the data. <strong>VegVault</strong> currently includes 706 sources of <code>Datasets</code>, each documented to ensure reliability and ease of use. Each dataset can also have one or more direct references to specific data, further ensuring that users can accurately cite and verify the sources of their data.</p>
<p><img src="DB_scheme_visualisation/DatasetReference.png" style="width:100.0%" data-fig-align="center"></p>
<p>This means that one dataset can have one/several references from each of those parts. Let’s take a look at an example, of what that could mean in practice.</p>
<p>We have selected dataset ID: 91256, which is a fossil pollen archive. Therefore, it has the reference of the <em>Dataser Source-Type</em>: <em>https://doi.org/10.1111/geb.13693</em> and reference for the individual dataset: <em>Grimm, E.C., 2008. Neotoma: an ecosystem database for the Pliocene, Pleistocene, and Holocene. Illinois State Museum Scientific Papers E Series, 1.</em></p>
</section>
</section>
<section id="samples" class="level2">
<h2 class="anchored" data-anchor-id="samples">Samples</h2>
<p><code>Samples</code> represent the main unit of data in the <strong>VegVault</strong> database, serving as the fundamental building blocks for all analyses. There are currently over 13 millions of <code>Samples</code> in the <strong>VegVault</strong> database (of which ~ 1.6 millions are <code>gridpoints</code>, artificially created to hold abiotic data, see below).</p>
<p><img src="DB_scheme_visualisation/Samples.png" style="width:100.0%" data-fig-align="center"></p>
<section id="dataset-sample" class="level3">
<h3 class="anchored" data-anchor-id="dataset-sample">Dataset-Sample</h3>
<p>Each sample is linked to a specific <code>Dataset</code> via the <code>Dataset-Sample</code> table, which ensures that every sample is correctly associated with its corresponding <code>Dataset Type</code>, whether it is current <code>vegetation_plots</code>, <code>fossil_pollen_archive</code>, <code>traits</code>, or <code>gridpoint</code>.</p>
<p><img src="DB_scheme_visualisation/DatasetSample.png" style="width:100.0%" data-fig-align="center"></p>
<p><img src="../Figures/ fig_n_samples_per_dataset_type .png" style="width:100.0%" data-fig-align="center"></p>
</section>
<section id="sample-size" class="level3">
<h3 class="anchored" data-anchor-id="sample-size">Sample-size</h3>
<p>The size of vegetation plots can vary, impacting the analyses and interpretations of the data. To account for this variability, information about the plot size is recorded separately for each <code>Sample</code>. This detail is crucial for ecological studies where plot size can influence species diversity and abundance metrics.</p>
<p><img src="DB_scheme_visualisation/SampleSizeID.png" style="width:100.0%" data-fig-align="center"></p>
<p><img src="../Figures/ fig_samples_plot_size .png" style="width:100.0%" data-fig-align="center"></p>
</section>
<section id="sample-age" class="level3">
<h3 class="anchored" data-anchor-id="sample-age">Sample age</h3>
<p><strong>VegVault</strong> encompasses both current and paleo data, necessitating accurate age information for each sample. Modern samples are assigned an age of 0, while paleo samples uses calibrated years before present (cal yr BP). The “present” is here specified as 1950 AD. In addition, each <code>Sample</code> from <code>fossil_pollen_archive</code> <code>Dataset</code> is also associated with an uncertainty matrix. This matrix provides a range of potential ages derived from age-depth modelling, reflecting the inherent uncertainty in dating paleoecological records. For instance, we include detailed age uncertainty information for a fossil pollen archive with an example <code>Dataset</code>.</p>
<p><img src="DB_scheme_visualisation/SampleUncertainty.png" style="width:100.0%" data-fig-align="center"></p>
<p>We can show this on the previously selected fossil pollen archive with dataset ID: 91256.</p>
<p><img src="../Figures/ fig_sample_age .png" style="width:100.0%" data-fig-align="center"></p>
</section>
<section id="sample-reference" class="level3">
<h3 class="anchored" data-anchor-id="sample-reference">Sample reference</h3>
<p>Each <code>Sample</code> in <strong>VegVault</strong> can have specific references in addition to the <code>Dataset</code>-level references. These individual <code>Sample</code> references provide detailed provenance and citation information, ensuring that users can trace the origin and validation of each data point. This level of referencing enhances the transparency and reliability of the data, especially when the database continues to be updated in the future.</p>
<p><img src="DB_scheme_visualisation/SampleReference.png" style="width:100.0%" data-fig-align="center"></p>
</section>
</section>
<section id="taxa" class="level2">
<h2 class="anchored" data-anchor-id="taxa">Taxa</h2>
<p>The <strong>VegVault</strong> database records taxa names derived directly from the primary data sources. Each individual <code>Taxon</code> is linked to corresponding <code>Samples</code> through the <code>SampleTaxa</code> table, ensuring accurate and systematic association between species and their ecological data.</p>
<p><img src="DB_scheme_visualisation/Taxa.png" style="width:100.0%" data-fig-align="center"></p>
<p><img src="DB_scheme_visualisation/SampleTaxa.png" style="width:100.0%" data-fig-align="center"></p>
<p><img src="../Figures/ fig_n_taxa_per_source_type .png" style="width:100.0%" data-fig-align="center"></p>
<section id="classification" class="level3">
<h3 class="anchored" data-anchor-id="classification">Classification</h3>
<p>To classify the diverse taxa present in the <strong>VegVault</strong> database, the {<a href="https://github.com/OndrejMottl/taxospace">taxospace</a>} R package was used. This tool automatically aligns taxa names with the <a href="https://www.gbif.org/dataset/d7dddbf4-2cf0-4f39-9b2a-bb099caae36c">Taxonomy Backbone</a> from the <a href="https://www.gbif.org/">Global Biodiversity Information Facility</a>, providing a standardized classification framework. Specifically, we try to find the best match of the raw names of taxa using <a href="https://resolver.globalnames.org/">Global Names Resolver</a>. Classification information, detailed up to the family level, is stored for each taxon, ensuring consistency and facilitating comparative analyses across different datasets. Currently, the <strong>VegVault</strong> database holds over 110 thousand taxonomic names, of which we were unable to classify only 1312 (1.2%).</p>
<p><img src="DB_scheme_visualisation/TaxonClassification.png" style="width:100.0%" data-fig-align="center"></p>
<p><img src="../Figures/ fig_n_taxa_per_class .png" style="width:100.0%" data-fig-align="center"></p>
</section>
</section>
<section id="traits" class="level2">
<h2 class="anchored" data-anchor-id="traits">Traits</h2>
<p>Functional traits of vegetation taxa follow the same structure of <code>Dataset</code> and <code>Samples</code> obtained directly from <code>Dataset</code> <code>Source-Types</code>.</p>
<p><img src="DB_scheme_visualisation/Traits.png" style="width:100.0%" data-fig-align="center"></p>
<section id="trait-domain" class="level3">
<h3 class="anchored" data-anchor-id="trait-domain">Trait domain</h3>
<p>As there are differences in trait names across sources of data and individual <code>Datasets</code>, the <strong>VegVault</strong> database contains <code>Trait Domain</code> information to group traits together.</p>
<p><img src="DB_scheme_visualisation/TraitsDomain.png" style="width:100.0%" data-fig-align="center"></p>
<p>There are currently 6 <code>Trait Domains</code> following the <a href="https://www.nature.com/articles/nature16489">Diaz et al.&nbsp;(2016)</a></p>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 68%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Trait domain</th>
<th>Trait</th>
<th>Data source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Stem specific density</td>
<td>stem wood density</td>
<td>BIEN</td>
</tr>
<tr class="even">
<td>Stem specific density</td>
<td>Stem specific density (SSD, stem dry mass per stem fresh volume) or wood density</td>
<td>TRY</td>
</tr>
<tr class="odd">
<td>Leaf nitrogen content per unit mass</td>
<td>leaf nitrogen content per leaf dry mass</td>
<td>BIEN</td>
</tr>
<tr class="even">
<td>Leaf nitrogen content per unit mass</td>
<td>Leaf nitrogen (N) content per leaf dry mass</td>
<td>TRY</td>
</tr>
<tr class="odd">
<td>Diaspore mass</td>
<td>seed mass</td>
<td>BIEN</td>
</tr>
<tr class="even">
<td>Diaspore mass</td>
<td>Seed dry mass</td>
<td>TRY</td>
</tr>
<tr class="odd">
<td>Plant heigh</td>
<td>whole plant height</td>
<td>BIEN</td>
</tr>
<tr class="even">
<td>Plant heigh</td>
<td>Plant height vegetative</td>
<td>TRY</td>
</tr>
<tr class="odd">
<td>Leaf Area</td>
<td>leaf area</td>
<td>BIEN</td>
</tr>
<tr class="even">
<td>Leaf Area</td>
<td>Leaf area (in case of compound leaves undefined if leaf or leaflet, undefined if petiole is in- or exluded)</td>
<td>TRY</td>
</tr>
<tr class="odd">
<td>Leaf Area</td>
<td>Leaf area (in case of compound leaves: leaf, petiole excluded)</td>
<td>TRY</td>
</tr>
<tr class="even">
<td>Leaf Area</td>
<td>Leaf area (in case of compound leaves: leaf, petiole included)</td>
<td>TRY</td>
</tr>
<tr class="odd">
<td>Leaf Area</td>
<td>Leaf area (in case of compound leaves: leaf, undefined if petiole in- or excluded)</td>
<td>TRY</td>
</tr>
<tr class="even">
<td>Leaf mass per area</td>
<td>leaf mass per area</td>
<td>BIEN</td>
</tr>
<tr class="odd">
<td>Leaf mass per area</td>
<td>Leaf area per leaf dry mass (specific leaf area, SLA or 1/LMA): petiole included</td>
<td>TRY</td>
</tr>
<tr class="even">
<td>Leaf mass per area</td>
<td>Leaf area per leaf dry mass (specific leaf area, SLA or 1/LMA): undefined if petiole is in- or excluded)</td>
<td>TRY</td>
</tr>
</tbody>
</table>
<p><img src="../Figures/ fig_n_traits_per_domain .png" style="width:100.0%" data-fig-align="center"></p>
</section>
<section id="trait-values" class="level3">
<h3 class="anchored" data-anchor-id="trait-values">Trait Values</h3>
<p>Storing trait values in <strong>VegVault</strong> involves linking information across <code>Datasets</code>, <code>Samples</code>, <code>Taxa</code>, and <code>Traits</code>. This comprehensive linkage ensures that each trait value is accurately associated with its relevant ecological, environmental and taxonomic context.</p>
<p><img src="DB_scheme_visualisation/TraitsValue.png" style="width:100.0%" data-fig-align="center"></p>
<p><img src="../Figures/ fig_n_occurences_per_dommain .png" style="width:100.0%" data-fig-align="center"></p>
</section>
<section id="trait-reference" class="level3">
<h3 class="anchored" data-anchor-id="trait-reference">Trait reference</h3>
<p>To ensure clarity and reproducibility, each trait in the <strong>VegVault</strong> database can have additional <code>References</code> beyond the general <code>Dataset</code> and <code>Sample</code> references. These trait-specific <code>References</code> provide detailed provenance and citation information, supporting rigorous scientific research and enabling users to trace the origins and validation of each trait value.</p>
<p><img src="DB_scheme_visualisation/TraitsReference.png" style="width:100.0%" data-fig-align="center"></p>
</section>
</section>
<section id="abiotic-data" class="level2">
<h2 class="anchored" data-anchor-id="abiotic-data">Abiotic data</h2>
<p>The abiotic data in the <strong>VegVault</strong> database provide essential information on environmental factors affecting vegetation distribution and traits. These data include variables such as climate and soil conditions, which are crucial for understanding the ecological contexts of vegetation dynamics.</p>
<p>Currently, <strong>VegVault</strong> includes abiotic data from <a href="https://chelsa-climate.org/">CHELSA</a>, <a href="https://chelsa-climate.org/chelsa-trace21k/">CHELSA-TRACE21</a>, and <a href="https://www.isric.org/explore/wosis">WoSIS</a>. CHELSA and CHELSA-TRACE21 provide high-resolution climate data, while WoSIS offers detailed soil information.</p>
<table class="table">
<thead>
<tr class="header">
<th>Variable name</th>
<th>Variable unit</th>
<th>source of data</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>bio1</td>
<td>Â°C</td>
<td>CHELSA</td>
</tr>
<tr class="even">
<td>bio4</td>
<td>Â°C</td>
<td>CHELSA</td>
</tr>
<tr class="odd">
<td>bio6</td>
<td>Â°C</td>
<td>CHELSA</td>
</tr>
<tr class="even">
<td>bio12</td>
<td>kg m-2 year-1</td>
<td>CHELSA</td>
</tr>
<tr class="odd">
<td>bio15</td>
<td>Unitless</td>
<td>CHELSA</td>
</tr>
<tr class="even">
<td>bio18</td>
<td>kg m-2 quarter-1</td>
<td>CHELSA</td>
</tr>
<tr class="odd">
<td>bio19</td>
<td>kg m-2 quarter-1</td>
<td>CHELSA</td>
</tr>
<tr class="even">
<td>HWSD2</td>
<td>Unitless</td>
<td>WoSIS-SoilGrids</td>
</tr>
</tbody>
</table>
<p><img src="DB_scheme_visualisation/AbioticData.png" style="width:100.0%" data-fig-align="center"></p>
<p>Because original data are stored as raster, which cannot be stored in SQLite database, we created artificial points called <code>gridpoints</code> in the middle of each raster cell to represent the data. To unify the varying resolution of rasters and to limit the amount of data, we resampled all data into ~ 25km resolution and 500-year slices. This mean that there we created uniform spatio-temporal matrix of <code>gridpoints</code> to hold the abiotic data. Gridpoints are stored in artificially created <code>Datasets</code> and <code>Samples</code>, with one <code>Dataset</code> holding more <code>Samples</code> only if the differ in age. Next, we have estimated the spatial and temporal distance between each <code>gridpoint</code> and other non-<code>gridpoint</code> <code>Samples</code> (<code>vegetation_plot</code>, <code>fossil_pollen_archive</code>, and <code>traits</code>). We store the link between <code>gridpoint</code> and non-<code>gridpoint</code> <code>Samples</code> as well as the spatial and temporal distance. As this result in very amount of data, we have discarded any <code>gridpoint</code> Sample, which is not close to 50 km and/or 5000 years to any other non-<code>gridpoint</code> <code>Samples</code> as not relevant for the vegetation dynamics.</p>
<p><img src="../Figures/ fig_data_grid_coord .png" style="width:100.0%" data-fig-align="center"></p>
<p>Such data structure allow that environmental context is readily available for each vegetation and trait <code>Sample</code>. while for each non-<code>gridpoint</code> <code>Sample</code>, user can select the closest spatio-temporally abiotic data or get average from all surrounding <code>gridpoints</code>.</p>
<p><img src="DB_scheme_visualisation/AbioticDataReference.png" style="width:100.0%" data-fig-align="center"></p>
<p><img src="../Figures/ fig_gridpoint_links_example .png" style="width:100.0%" data-fig-align="center"></p>
<p>By providing comprehensive and well-structured abiotic data, VegVault enhances the ability to study the interactions between vegetation and their environment, supporting advanced ecological research and modelling efforts.</p>
</section>
</section>
<section id="section-iii-assembly-details-of-vegvault-1.0.0" class="level1">
<h1>Section III: Assembly details of VegVault 1.0.0</h1>
<p>The <strong>VegVault</strong> version <strong>1.0.0</strong> has been assembled from other publicly available databases.</p>
<section id="assembly-process" class="level2">
<h2 class="anchored" data-anchor-id="assembly-process">Assembly process</h2>
<p>Here is a general visualisation of the assembly process:</p>
<p><img src="DB_assembly_visualisation/assembly_viz_01.png" style="width:100.0%" data-fig-align="center"></p>
<p><strong>Figure legend</strong>:</p>
<ol type="1">
<li><strong><a href="https://www.neotomadb.org/">Neotoma Paleoecology Database</a></strong> - open, community-curated data and services for paleoecological and paleoenvironmental data
<ul>
<li>source of fossil pollen data</li>
</ul></li>
<li><strong><a href="https://idiv-biodiversity.de/en/splot/splotopen.html">sPlotOpen</a></strong> - The open-access version of sPlot
<ul>
<li>source of current vegetation plot data</li>
</ul></li>
<li><strong><a href="https://bien.nceas.ucsb.edu/bien/">Botanical Information and Ecology Network</a></strong> - global patterns of plot inventories and surveys
<ul>
<li>source of current vegetation plot and vegetation trait data</li>
</ul></li>
<li><strong><a href="https://www.try-db.org/TryWeb/Home.php">TRY Plant Trait Database</a></strong> - open access plant trait data
<ul>
<li>source of vegetation trait data</li>
</ul></li>
<li><strong><a href="https://chelsa-climate.org/">Climatologies at High resolution for the Earth’s Land Surface Area</a></strong> - Long-term, transient modern- and paleo-climate data
<ul>
<li>source of abiotic data</li>
</ul></li>
<li><strong><a href="https://www.isric.org/explore/wosis">World Soil Information Service</a></strong> - harmonised soil profile database
<ul>
<li>source of abiotic data</li>
</ul></li>
<li><strong><a href="https://hope-uib-bio.github.io/FOSSILPOL-website/">FOSSILPOL</a></strong> - The workflow that aims to process and standardise global palaeoecological pollen data for macroecological studies
<ul>
<li>a method to obtain and process fossil pollen data</li>
</ul></li>
<li><strong><a href="https://github.com/bmaitner/RBIEN">RBIEN R package</a></strong> - Tools for accessing the BIEN database
<ul>
<li>a method to obtain current vegetation plot data</li>
</ul></li>
<li><strong><a href="https://github.com/OndrejMottl/VegVault-FOSSILPOL/tree/v1.0.0">VegVault-FOSSILPOL GitHub repo</a></strong>
<ul>
<li>a Tag (v1.0.0) to obtain and process fossil pollen data</li>
</ul></li>
<li><strong><a href="https://github.com/OndrejMottl/VegVault-Vegetation_data/tree/v1.0.0">VegVault-Vegetation_data GitHub repo</a></strong>
<ul>
<li>a Tag (v1.0.0) to process current vegetation plot data</li>
</ul></li>
<li><strong><a href="https://github.com/OndrejMottl/VegVault-Trait_data/tree/v1.1.0">VegVault-Trait_data GitHub repo</a></strong>
<ul>
<li>a Tag (v1.1.0) to process vegetation trait data</li>
</ul></li>
<li><strong><a href="https://github.com/OndrejMottl/VegVault-abiotic_data/tree/v1.1.0">VegVault-abiotic_data GitHub repo</a></strong>
<ul>
<li>a Tag (v1.1.0) to process abiotic data</li>
</ul></li>
<li><strong><a href="https://github.com/OndrejMottl/VegVault">VegVault GitHub repo</a></strong>
<ul>
<li>a Tag (v1.0.0) to transfer the data into the SQLite database</li>
</ul></li>
<li><strong>VegVault</strong> - SQLite database (v1.0.0)</li>
</ol>
<section id="note-on-github-tags" class="level3">
<h3 class="anchored" data-anchor-id="note-on-github-tags">Note on GitHub Tags</h3>
<p><em>…Tags are ref’s that point to specific points in Git history. Tagging is generally used to capture a point in history…</em></p>
<p>Here, the Tags have been used to ensure reproducibility of this version of <strong>VegVault</strong>. GitHub repo can change but the specific Tag used here (and also used in the code to source the data) ensure the transparency of the state of the database.</p>
</section>
</section>
</section>
<section id="section-iv-examples-of-usage" class="level1">
<h1>Section IV: Examples of usage</h1>
<p>The <strong>VegVault</strong> database can be accessed via our newly developed <a href="https://github.com/OndrejMottl/vaultkeepr">{vaultkeepr} R-package</a>, which provides a series of easy-to-use functions in <a href="https://en.wikipedia.org/wiki/R_(programming_language)">R programming language</a>.</p>
<p>The {vaultkeepr} can be installed from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("remotes")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"OndrejMottl/vaultkeepr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and then all functions will be made available by attaching as:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vaultkeepr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="example-1-spatiotemporal-patterns-of-the-picea-genus-across-north-america-since-the-lgm" class="level2">
<h2 class="anchored" data-anchor-id="example-1-spatiotemporal-patterns-of-the-picea-genus-across-north-america-since-the-lgm">Example 1: Spatiotemporal patterns of the Picea genus across North America since the LGM</h2>
<p>In the first example, we can imagine a scenario, where we are interested in spatiotemporal patterns of the <em>Picea</em> genus across North America for modern data and since the Last Glacial Maximum. Obtaining such data is straightforward:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data_na_plots_picea <span class="ot">&lt;-</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Access the VegVault</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">open_vault</span>(<span class="at">path =</span> <span class="st">"&lt;path_to_VegVault&gt;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Start by adding dataset information</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">get_datasets</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select both modern and paleo plot data</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">select_dataset_by_type</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sel_dataset_type =</span> <span class="fu">c</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"vegetation_plot"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"fossil_pollen_archive"</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Limit data to North America</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">select_dataset_by_geo</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat_lim =</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">60</span>),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">long_lim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">135</span>, <span class="sc">-</span><span class="dv">60</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add samples</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">get_samples</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Limit the samples by age</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">select_samples_by_age</span>(</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_lim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">15e3</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add taxa &amp; classify all data to a genus level</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">get_taxa</span>( <span class="at">classify_to =</span> <span class="st">"genus"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract only Picea data</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">select_taxa_by_name</span>(<span class="at">sel_taxa =</span> <span class="st">"Picea"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">extract_data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, we plot the presence of <em>Picea</em> in each 2500-year bin.</p>
<p><img src="../Figures/fig_na_plots_picea.png" style="width:100.0%" data-fig-align="center"></p>
</section>
<section id="example-2-joined-species-distribution-model-for-all-vegetation-within-czechia" class="level2">
<h2 class="anchored" data-anchor-id="example-2-joined-species-distribution-model-for-all-vegetation-within-czechia">Example 2: Joined Species Distribution model for all vegetation within Czechia</h2>
<p>In the second example, let’s imagine we want to do Species Distribution Modeling for all plant taxa in the Czech Republic. We will extract modern plot-based data and Mean Annual temprature.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data_cz_modern <span class="ot">&lt;-</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Acess the VegVault file</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">open_vault</span>(<span class="at">path =</span> <span class="st">"&lt;path_to_VegVault&gt;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the dataset information</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">get_datasets</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select modern plot data and climate</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">select_dataset_by_type</span>(</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sel_dataset_type =</span> <span class="fu">c</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"vegetation_plot"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"gridpoints"</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Limit data to Czech Republic</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">select_dataset_by_geo</span>(</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat_lim =</span> <span class="fu">c</span>(<span class="fl">48.5</span>, <span class="fl">51.1</span>),</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">long_lim =</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="fl">18.9</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add samples</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">get_samples</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select only modern data</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">select_samples_by_age</span>(</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_lim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add abiotic data</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">get_abiotic_data</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only Mean Anual Temperature (bio1)</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">select_abiotic_var_by_name</span>(<span class="at">sel_var_name =</span> <span class="st">"bio1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add taxa</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">get_taxa</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">extract_data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we can simply plot both the climatic data and the plot vegetation data:</p>
<p><img src="../Figures/fig_cz_jsdm.png" style="width:100.0%" data-fig-align="center"></p>
</section>
<section id="example-3-patterns-of-plant-height-cwm-for-south-and-central-latin-america-between-6-12-ka" class="level2">
<h2 class="anchored" data-anchor-id="example-3-patterns-of-plant-height-cwm-for-south-and-central-latin-america-between-6-12-ka">Example 3: Patterns of plant height (CWM) for South and Central Latin America between 6-12 ka</h2>
<p>In the last example, let’s imagine we want to reconstruct the Community Weighted Mean (CWM) of plant height for Latin America between 6-12 ka yr BP.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data_la_traits <span class="ot">&lt;-</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Acess the VegVault file</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">open_vault</span>(<span class="at">path =</span> <span class="st">"&lt;path_to_VegVault&gt;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the dataset information</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">get_datasets</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select modern plot data and climate</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">select_dataset_by_type</span>(</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sel_dataset_type =</span> <span class="fu">c</span>(</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"fossil_pollen_archive"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"traits"</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Limit data to South and Central America</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">select_dataset_by_geo</span>(</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat_lim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">53</span>, <span class="dv">28</span>),</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">long_lim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">110</span>, <span class="sc">-</span><span class="dv">38</span>),</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sel_dataset_type =</span> <span class="fu">c</span>(</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">"fossil_pollen_archive"</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"traits"</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add samples</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">get_samples</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Limit to 6-12 ka yr BP</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">select_samples_by_age</span>(</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_lim =</span> <span class="fu">c</span>(<span class="fl">6e3</span>, <span class="fl">12e3</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add taxa &amp; clasify all data to a genus level</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">get_taxa</span>(<span class="at">classify_to =</span> <span class="st">"genus"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add trait information &amp; clasify all data to a genus level</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">get_traits</span>(<span class="at">classify_to =</span> <span class="st">"genus"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only select the plant height</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">select_traits_by_domain_name</span>(<span class="at">sel_domain =</span> <span class="st">"Plant heigh"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  vaultkeepr<span class="sc">::</span><span class="fu">extract_data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now let’s plot the overview of the data</p>
<p><img src="../Figures/fig_la_merge.png" style="width:100.0%" data-fig-align="center"></p>
<!--- {{< include _09_section_V.md >}} --->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>